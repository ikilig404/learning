# 类型、值和变量

计算机程序通过操作值（如数值3.14）或文本（如“HelloWorld”）来工作。编程语言中这些可以表示和操作的值被称为类型，而一门语言支持的类型集也是这门语言最基本的特征。程序在需要把某个值保存下来以便将来使用时，会把这个值赋给（或存人）变量。变量有名字，程序可以通过这些名字来引用值。变量的工作方式则是一门编程语言的另一个基本特征。本章讲解JavaScript中的类型、值和变量。首先从概念和一些定义开始。

## 1 概述与定义

JavaScript 类型可以分为两类：原始类型和对象类型。JavaScript 的原始类型包括数值、文本字符串（也称字符串）和布尔真值（也称布尔值）。本章将用很大篇幅专门详细讲解 JavaScript 中的数值（见3.2节）类型和字符串（见3.3节）类型。布尔值将在3.4节介绍。

JavaScript 中的特殊值`null`和`undefined`也是原始值，但它们不是数值、字符串或布尔值。这两个值通常被认为是各自特殊类型的唯一成员，将在3.5节进行介绍。ES6新增了一种特殊类型`Symbol`（符号)，用于对语言进行扩展而不破坏向后兼容性。3.6节将简单介绍符号。

在 JavaScript 中，任何不是数值、字符串、布尔值、符号、`null`和`undefined`的值都是对象。对象（也就是对象类型的成员）是属性的集合，其中每个属性都有一个名字和一个值（原始值或其他对象）。有一个非常特殊的对象叫全局对象，将在3.7节介绍。但关于对象更通用也更详尽的介绍会放在第6章。

普通 JavaScript 对象是一个命名值的无序集合。这门语言本身也定义一种特殊对象，称为数组。数组表示一个数字值的有序集合。JavaScript 语言包括操作数组的特殊语法，而数组本身也具有区别于普通对象的行为。数组是第7章的主题。

除了基本的对象和数组之外，JavaScript 还定义了其他一些有用的对象类型。`Set`对象表示一组值的集合，`Map`对象表示键与值的映射。各种“定型数组”（`typed array`）类型便于对字节数组和其他二进制数据进行操作。`RegExp`类型表示文本模式，可以实现对字符串的复杂匹配、搜索和替换操作。`Date`类型表示日期和时间，支持基本的日期计算。`Error`及其子类型表示 JavaScript 代码运行期间可能发生的错误。所有这些类型将在第11章介绍。

JavaScript 与静态语言更大的差别在于，函数和类不仅仅是语言的语法，它们本身就是可以被JavaScript 程序操作的值。与其他 JavaScript 非原始值一样，函数和类也是特殊的对象。第8章和第9章将详细介绍它们。

在内存管理方面，JavaScript 解释器会执行自动垃圾收集。这意味着 JavaScript 程序员通常不用关心对象或其他值的析构与释放。当一个值无法触达时，或者说当程序无法以任何方式引用这个值时，解释器就知道这个值已经用不到了，会自动释放它占用的内存（JavaScript 程序员有时候需要留意，不能让某些值在不经意间存续过长时间后仍可触达，从而导致它们无法被回收）。

JavaScript 支持面向对象的编程风格。粗略地说，这意味着不用定义全局函数去操作不同类型的值，而是由这些类型本身定义操作值的方法。比如要对数组元素排序，不用把数组传给一个`sort()`函数，而是可以调用数组`a`的`sort()`方法：

```js
a.sort()  // sort(a)的面向对象版
```

第 9 章将介绍如何定义方法。从技术角度来讲，只有 JavaScript 对象才有方法。但数值、字符串、布尔值和符号表现得似乎它们也有方法。在 JavaScript 中，只有`null`和`undefined`是不能调用方法的值。

JavaScript 的对象类型是可修改的（`mutable`)，而它的原始类型是不可修改的（`immutable`）。可修改类型的值可以改变，比如 JavaScript 程序可以修改对象属性和数组元素的值。数值、布尔值、符号、`null`和`undefined`是不可修改的，以数值为例，修改它是没有意义的。字符串可以看成字符数组，你可能期望它们是可修改的。但在 JavaScript 中，字符串也是不可修改的。虽然可以按索引访问字符串中的字符，但 JavaScript 没有提供任何方式去修改已有字符串的字符。可修改值与不可修改值的区别将在 3.8 节更详细地介绍。

JavaScript 可以自由地转换不同类型的值。比如，程序期待一个字符串，而你提供了一个数值，这个数值会自动转换为字符串。而如果你在一个期待布尔值的地方使用了非布尔值，JavaScript也会相应地把它转换为布尔值。这种自动转换的规则将在 3.9 节解释。

JavaScript 这种自由的值转换会影响对相等的定义，而相等操作符`==`会根据 3.9.1 节的描述进行类型转换（不过在实践中，相等操作符`==`已经被弃用，取而代之的是不会做类型转换的严格相等操作符`===`。关于这两个操作符的更多介绍可以参见 4.9.1 节）。

常量和变量可以让我们在程序中使用名字来引用值。常量使用`const`声明，变量使用`let`（或在较老的 JavaScript 代码中使用`var`）声明。JavaScript 常量和变量是无类型的(`untyped`)，声明并不会限定要赋何种类型的值。变量声明和赋值将在3.10节介绍。

看完以上概述，想必读者也已经心领神会了。这一章内容非常宽泛，涉及 JavaScript 如何表示和操作数据的很多基础性细节。下面我们就从详尽了解 JavaScript 数值和文本开始。

## 2 数值

JavaScript 的主要数值类型`Number`用于表示整数和近似实数。JavaScript使用`IEEE754`标准定义的64 位浮点格式表示数值，这意味着 JavaScript 可以表示的最大整数是$\pm 1.797\,693\,134\,862\,315\,7 \times 10^{308}$，最小整数是$\pm 5 \times 10^{-324}$。

JavaScript 的这种数值格式可以让我们准确表示$-9\,007\,199\,254\,740\,992(-2^{53})$到$9\,007\,199\,254\,740\,992(2^{53})$之间的所有整数（含首尾值）。如果你的数值超出了这个范围，那可能会在末尾的数字上损失一些精度。但要注意，JavaScript 中的某些操作（如第4章介绍的数组索引和位操作）是以 32 位整数计算的。如果想准确表示更大的整数，可以参考 3.2.5 节。

当数值真正出现在 JavaScript 程序中时，就叫作数值字面量（numeric literal）。JavaScript 支持几种形式的数值字面量，后面几节会介绍。注意，任何数值字面量前面都可以加上一个减号（`-`）将数值变成负值。

### 2.1 整数字面量

在 JavaScript 程序中，基数为 10 的整数可以直接写成数字序列。例如：

```js
0
3
10000000
```

除了基数为 10 的整数字面量之外，JavaScript 也支持十六进制（基数是 16 的）值。十六进制字面量以`0x`或`0X`开头，后跟一个十六进制数字字符串。十六进制数字是数字 0 到 9 和字母 a（或A）到f（或F）,a 到 f 表示 10 到 15 。下面是十六进制整数字面量的例子：

```js
0xff // => 255:（15*16+15)
0xBADCAFE // => 195939070
```

在 ES6 及之后的版本中，也可以通过二进制（基数为2）或八进制（基数为8）表示整数，分别使用前缀`0b`和`0o`（或`0B`和`0O`)：

```js
0b10101 // =>21:（1*16+0*8+1*4+0*2+1*1)
0o377  // => 255:(3*64+7*8+7*1)
```

### 2.2 浮点字面量

浮点字面量可以包含小数点，它们对实数使用传统语法。实数值由数值的整数部分、小数点和数值的小数部分组成。

浮点字面量也可以使用指数记数法表示，即实数值后面可以跟字母e（或E)，跟一个可选的加号或减号，再跟一个整数指数。这种记数法表示的是实数值乘以10的指数次幂。

更简洁的语法形式为：`[digits][.digits][(E|e)[(+|-)]digits]`

例如：

```js
3.14
2345.6789
.333333333333333333
6.02e23 // 6.02 × 10²³
1.4738223E-32 // 1.4738223×10-³²
```

可以用下划线将数值字面量分隔为容易看清的数字段：

```js
let billion = 1_000_000_000; // 以下划线作为千分位分隔符
let bytes = 0x89_AB_CD_EF;  // 作为字节分隔符
let bits = 0b0001_1101_0111; // 作为半字节分隔符
let fraction = 0.123_456_789; // 也可以用在小数部分
```

在 2020 年年初写作本书时，数值字面量中像这样添加下划线还没有成为正式的 JavaScript 标准。但这个特性已经进入标准化流程的后期，而且已经被所有主流浏览器以及 Node 实现了。
