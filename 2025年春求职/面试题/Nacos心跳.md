# **Nacos心跳**

Nacos 的心跳机制是服务实例与 Nacos 服务器之间保持健康状态的关键机制，确保服务实例的在线状态能够被实时感知。以下是其核心要点，方便你理解和记忆：

1. **心跳的作用**

- **健康检查**：通过心跳，Nacos 可以判断服务实例是否在线。
- **服务续约**：心跳也是一种续约机制，表明服务实例仍在运行。
- **心跳的实现方式**

- **客户端主动发送**：服务实例定期向 Nacos 服务器发送心跳请求。
- **HTTP 请求**：通常通过 HTTP 请求 /nacos/v1/ns/instance/beat 发送心跳。
- **心跳的核心参数**

- **心跳间隔（heartBeatInterval）**：服务实例发送心跳的时间间隔，默认 5 秒。
- **心跳超时（heartBeatTimeout）**：Nacos 服务器判断服务实例下线的时间，默认 15 秒。
- **IP 删除超时（ipDeleteTimeout）**：服务实例下线后，IP 从注册列表移除的时间，默认 30 秒。
- **心跳的流程**

1. **服务启动**：服务实例启动后，向 Nacos 注册并开始发送心跳。
2. **定期发送**：每隔 heartBeatInterval 发送一次心跳。
3. **服务器响应**：Nacos 收到心跳后，更新该实例的最后心跳时间。
4. **超时处理**：如果 Nacos 在 heartBeatTimeout 内未收到心跳，标记实例为不健康。
5. **移除实例**：如果超过 ipDeleteTimeout 仍未收到心跳，Nacos 从注册列表中移除该实例。
6. **记忆口诀**

- **5 秒发心跳**：默认每 5 秒发送一次心跳。
- **15 秒判超时**：15 秒内未收到心跳，标记为不健康。
- **30 秒删 IP**：30 秒内仍未收到心跳，移除实例。
- **注意事项**

- **网络抖动**：网络不稳定可能导致心跳丢失，适当调整超时时间。
- **客户端异常**：客户端异常可能导致心跳停止，需确保客户端稳定运行。